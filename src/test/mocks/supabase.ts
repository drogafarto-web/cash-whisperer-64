import { vi } from 'vitest';
import { Invoice, Payer, InvoiceOcrResult } from '@/types/billing';

export const mockSupabaseClient = {
  from: vi.fn(() => ({
    select: vi.fn().mockReturnThis(),
    insert: vi.fn().mockReturnThis(),
    update: vi.fn().mockReturnThis(),
    delete: vi.fn().mockReturnThis(),
    eq: vi.fn().mockReturnThis(),
    neq: vi.fn().mockReturnThis(),
    gte: vi.fn().mockReturnThis(),
    lte: vi.fn().mockReturnThis(),
    order: vi.fn().mockReturnThis(),
    single: vi.fn().mockReturnThis(),
  })),
  functions: {
    invoke: vi.fn(),
  },
  auth: {
    getUser: vi.fn().mockResolvedValue({ data: { user: null }, error: null }),
    getSession: vi.fn().mockResolvedValue({ data: { session: null }, error: null }),
  },
};

export const createMockQueryResult = <T>(data: T) => ({
  data,
  error: null,
});

export const createMockQueryError = (message: string) => ({
  data: null,
  error: { message },
});

export const mockInvoices: Partial<Invoice>[] = [
  {
    id: '1',
    document_number: '001',
    document_full_number: '001-2025',
    verification_code: 'ABC123',
    issue_date: '2025-01-15',
    customer_name: 'Cliente Teste',
    customer_cnpj: '12345678000100',
    customer_city: 'São Paulo',
    service_value: 1000,
    deductions: 50,
    iss_value: 25,
    net_value: 950,
    status: 'ABERTA',
    competence_year: 2025,
    competence_month: 1,
    payer_id: 'payer-1',
    issuer_name: 'Lab Teste',
    issuer_cnpj: '98765432000100',
    description: 'Serviços laboratoriais',
    service_code: '1234',
    cnae: '8640-2/02',
    unit_id: null,
    file_path: null,
    file_name: null,
    received_at: null,
    notes: null,
    created_by: 'user-1',
    created_at: '2025-01-15T10:00:00Z',
    updated_at: '2025-01-15T10:00:00Z',
  },
  {
    id: '2',
    document_number: '002',
    document_full_number: '002-2025',
    verification_code: 'DEF456',
    issue_date: '2025-01-20',
    customer_name: 'Cliente 2',
    customer_cnpj: '11111111000100',
    customer_city: 'Rio de Janeiro',
    service_value: 2000,
    deductions: 100,
    iss_value: 50,
    net_value: 1900,
    status: 'RECEBIDA',
    competence_year: 2025,
    competence_month: 1,
    payer_id: 'payer-2',
    issuer_name: 'Lab Teste',
    issuer_cnpj: '98765432000100',
    description: 'Serviços laboratoriais',
    service_code: '1234',
    cnae: '8640-2/02',
    unit_id: null,
    file_path: null,
    file_name: null,
    received_at: '2025-01-25T10:00:00Z',
    notes: null,
    created_by: 'user-1',
    created_at: '2025-01-20T10:00:00Z',
    updated_at: '2025-01-25T10:00:00Z',
  },
];

export const mockPayers: Partial<Payer>[] = [
  {
    id: 'payer-1',
    name: 'Convênio Teste',
    cnpj: '12345678000100',
    type: 'convenio',
    email: 'convenio@teste.com',
    phone: '11999999999',
    city: 'São Paulo',
    state: 'SP',
    address: 'Rua Teste, 123',
    notes: null,
    active: true,
    created_by: 'user-1',
    created_at: '2025-01-01T10:00:00Z',
    updated_at: '2025-01-01T10:00:00Z',
  },
  {
    id: 'payer-2',
    name: 'Convênio 2',
    cnpj: '98765432000100',
    type: 'convenio',
    email: 'convenio2@teste.com',
    phone: '11888888888',
    city: 'Rio de Janeiro',
    state: 'RJ',
    address: 'Av. Brasil, 456',
    notes: null,
    active: true,
    created_by: 'user-1',
    created_at: '2025-01-01T10:00:00Z',
    updated_at: '2025-01-01T10:00:00Z',
  },
];

export const mockOcrResult: InvoiceOcrResult = {
  document_number: '12345',
  document_full_number: '12345-2025',
  verification_code: 'XYZ789',
  issue_date: '2025-01-15',
  competence_year: 2025,
  competence_month: 1,
  service_value: 1500,
  deductions: 75,
  iss_value: 37.5,
  net_value: 1425,
  issuer_name: 'Lab OCR',
  issuer_cnpj: '12345678000100',
  customer_name: 'Cliente OCR',
  customer_cnpj: '98765432000100',
  customer_city: 'Belo Horizonte',
  description: 'Serviços de análise',
  service_code: '1234',
  cnae: '8640-2/02',
  confidence: 0.95,
};
